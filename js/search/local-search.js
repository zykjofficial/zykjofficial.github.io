"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(r.push(a.value),!t||r.length!==t);o=!0);}catch(e){l=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw i}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,t=function(){};return{s:t,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){o=!0,i=e},f:function(){try{r||null==n.return||n.return()}finally{if(o)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var LocalSearch=function(){function a(e){var t=e.path,n=void 0===t?"":t,t=e.unescape,t=void 0!==t&&t,e=e.top_n_per_article,e=void 0===e?1:e;_classCallCheck(this,a),this.path=n,this.unescape=t,this.top_n_per_article=e,this.isfetched=!1,this.datas=null}return _createClass(a,[{key:"getIndexByWord",value:function(e,r,t){var o=this,l=2<arguments.length&&void 0!==t&&t,s=[],c=new Set;return l||(r=r.toLowerCase()),e.forEach(function(e){var t;o.unescape&&((t=document.createElement("div")).innerText=e,e=t.innerHTML);var n=e.length;if(0!==n){var a,i=0;for(l||(e=e.toLowerCase());-1<(a=r.indexOf(e,i));)s.push({position:a,word:e}),c.add(e),i=a+n}}),s.sort(function(e,t){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length}),[s,c]}},{key:"mergeIntoSlice",value:function(e,t,n){for(var a=n[0],i=a.position,r=a.word,o=[],l=new Set;i+r.length<=t&&0!==n.length;){l.add(r),o.push({position:i,length:r.length});var s=i+r.length;for(n.shift();0!==n.length&&(i=(a=n[0]).position,r=a.word,i<s);)n.shift()}return{hits:o,start:e,end:t,count:l.size}}},{key:"highlightKeyword",value:function(e,t){var n="",a=t.start,i=_createForOfIteratorHelper(t.hits);try{for(i.s();!(o=i.n()).done;){var r=o.value,o=r.position,r=r.length;n+=e.substring(a,o),a=o+r,n+='<mark class="search-keyword">'.concat(e.substr(o,r),"</mark>")}}catch(e){i.e(e)}finally{i.f()}return n+=e.substring(a,t.end)}},{key:"getResultItems",value:function(h){var g=this,f=[];return this.datas.forEach(function(e){var t=e.title,n=e.content,a=e.url,i=_slicedToArray(g.getIndexByWord(h,t),2),r=i[0],o=i[1],e=_slicedToArray(g.getIndexByWord(h,n),2),l=e[0],i=e[1],e=new Set([].concat(_toConsumableArray(o),_toConsumableArray(i))).size,o=r.length+l.length;if(0!==o){i=[];0!==r.length&&i.push(g.mergeIntoSlice(0,t.length,r));for(var s=[];0!==l.length;){var c=l[0].position,u=Math.max(0,c-20),c=Math.min(n.length,c+100);s.push(g.mergeIntoSlice(u,c,l))}s.sort(function(e,t){return e.count!==t.count?t.count-e.count:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});r=parseInt(g.top_n_per_article,10);0<=r&&(s=s.slice(0,r));var d="";(a=new URL(a,location.origin)).searchParams.append("highlight",h.join(" ")),0!==i.length?d+='<li class="local-search-hit-item"><a href="'.concat(a.href,'"><span class="search-result-title">').concat(g.highlightKeyword(t,i[0]),"</span>"):d+='<li class="local-search-hit-item"><a href="'.concat(a.href,'"><span class="search-result-title">').concat(t,"</span>"),s.forEach(function(e){d+='<p class="search-result">'.concat(g.highlightKeyword(n,e),"...</p>")}),d+="</a></li>",f.push({item:d,id:f.length,hitCount:o,includedCount:e})}}),f}},{key:"fetchData",value:function(){var t=this,n=!this.path.endsWith("json");fetch(this.path).then(function(e){return e.text()}).then(function(e){t.isfetched=!0,t.datas=n?_toConsumableArray((new DOMParser).parseFromString(e,"text/xml").querySelectorAll("entry")).map(function(e){return{title:e.querySelector("title").textContent,content:e.querySelector("content").textContent,url:e.querySelector("url").textContent}}):JSON.parse(e),t.datas=t.datas.filter(function(e){return e.title}).map(function(e){return e.title=e.title.trim(),e.content=e.content?e.content.trim().replace(/<[^>]+>/g,""):"",e.url=decodeURIComponent(e.url).replace(/\/{2,}/g,"/"),e}),window.dispatchEvent(new Event("search:loaded"))})}},{key:"highlightText",value:function(t,e,n){var a=t.nodeValue,i=e.start,r=[],o=_createForOfIteratorHelper(e.hits);try{for(o.s();!(u=o.n()).done;){var l=u.value,s=l.position,c=l.length,u=document.createTextNode(a.substring(i,s)),i=s+c,l=document.createElement("mark");l.className=n,l.appendChild(document.createTextNode(a.substr(s,c))),r.push(u,l)}}catch(e){o.e(e)}finally{o.f()}t.nodeValue=a.substring(i,e.end),r.forEach(function(e){t.parentNode.insertBefore(e,t)})}},{key:"highlightSearchWords",value:function(e){var n=this,t=new URL(location.href).searchParams.get("highlight"),a=t?t.split(" "):[];if(a.length&&e){for(var i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),r=[];i.nextNode();)i.currentNode.parentNode.matches("button, select, textarea, .mermaid")||r.push(i.currentNode);r.forEach(function(e){var t=_slicedToArray(n.getIndexByWord(a,e.nodeValue),1)[0];t.length&&(t=n.mergeIntoSlice(0,e.nodeValue.length,t),n.highlightText(e,t,"search-keyword"))})}}}]),a}();window.addEventListener("load",function(){var e=GLOBAL_CONFIG.localSearch,t=e.path,n=e.top_n_per_article,a=e.unescape,i=e.languages,e=e.pagination,r=e&&e.enable,o=new LocalSearch({path:t,top_n_per_article:n,unescape:a}),l=document.querySelector(".local-search-input input"),s=document.getElementById("local-search-stats"),c=document.getElementById("loading-status"),u=!t.endsWith("json"),d=0,h=e.hitsPerPage||10,g=[];r||(g=d=void 0);function f(e){w.pagination.style.display=r&&e?"":"none"}function p(e,t){var n=document.getElementById("local-search-results"),a=r?g.slice(d*h,(d+1)*h):t;if(r&&0===a.length&&0<g.length)return d=0,void p(e,t);a=a.map(function(e,t){t=r?d*h+t+1:t+1;return e.item.replace('<li class="local-search-hit-item">','<li class="local-search-hit-item" value="'.concat(t,'">'))}),n.innerHTML='<ol class="search-result-list">'.concat(a.join(""),"</ol>"),a=(r?g:t).length,a=i.hits_stats.replace(/\$\{hits}/,a),s.innerHTML='<hr><div class="search-result-stats">'.concat(a,"</div>"),r&&(a=Math.ceil(g.length/h),_(d,a,e)),t=0<t.length,f(t),window.pjax&&window.pjax.refresh(n)}function m(){var e,t,n;o.isfetched&&(e=l.value.trim().toLowerCase(),u&&(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")),""!==e&&(c.hidden=!1),t=e.split(/[-\s]+/),n=[],0<e.length&&(n=o.getResultItems(t)),1===t.length&&""===t[0]?(document.getElementById("local-search-results").textContent="",s.textContent="",f(!1),r&&(g=[],d=0)):0===n.length?function(e){document.getElementById("local-search-results").textContent="";var t=document.createElement("div");t.className="search-result-stats",t.textContent=i.hits_empty.replace(/\$\{query}/,e),s.innerHTML=t.outerHTML,f(!1),r&&(g=[],d=0)}(e):(n.sort(function(e,t){return e.includedCount!==t.includedCount?t.includedCount-e.includedCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id}),r&&(g=n,d=0),p(e,n)),c.hidden=!0)}function y(){window.innerWidth<768&&S.style.setProperty("--search-height",window.innerHeight+"px")}function v(){btf.overflowPaddingR.add(),btf.animateIn(I,"to_show 0.5s"),btf.animateIn(S,"titleScale 0.5s"),setTimeout(function(){l.focus()},300),P||(o.isfetched||o.fetchData(),l.addEventListener("input",m),P=!0),document.addEventListener("keydown",function e(t){"Escape"===t.code&&(k(),document.removeEventListener("keydown",e))}),y(),window.addEventListener("resize",y)}function b(){btf.addEventListenerPjax(document.querySelector("#search-button > .search"),"click",v)}var w={get pagination(){return document.getElementById("local-search-pagination")},get paginationList(){return document.querySelector("#local-search-pagination .ais-Pagination-list")}},_=function(e,t){if(t<=1)return w.pagination.style.display="none",void(w.paginationList.innerHTML="");w.pagination.style.display="block";var n=0===e,a=e===t-1,i=window.innerWidth<768?3:5,r=Math.max(0,e-Math.floor(i/2)),o=Math.min(t-1,r+i-1);o-r+1<i&&(r=Math.max(0,o-i+1));var l="";i<t&&0<r&&(l+='\n        <li class="ais-Pagination-item ais-Pagination-item--page">\n          <a class="ais-Pagination-link" aria-label="Page 1" href="#" data-page="0">1</a>\n        </li>',1<r&&(l+='\n          <li class="ais-Pagination-item ais-Pagination-item--ellipsis">\n            <span class="ais-Pagination-link">...</span>\n          </li>'));for(var s=r;s<=o;s++)l+=s===e?'\n          <li class="ais-Pagination-item ais-Pagination-item--page ais-Pagination-item--selected">\n            <span class="ais-Pagination-link" aria-label="Page '.concat(s+1,'">').concat(s+1,"</span>\n          </li>"):'\n          <li class="ais-Pagination-item ais-Pagination-item--page">\n            <a class="ais-Pagination-link" aria-label="Page '.concat(s+1,'" href="#" data-page="').concat(s,'">').concat(s+1,"</a>\n          </li>");i<t&&o<t-1&&(o<t-2&&(l+='\n          <li class="ais-Pagination-item ais-Pagination-item--ellipsis">\n            <span class="ais-Pagination-link">...</span>\n          </li>'),l+='\n        <li class="ais-Pagination-item ais-Pagination-item--page">\n          <a class="ais-Pagination-link" aria-label="Page '.concat(t,'" href="#" data-page="').concat(t-1,'">').concat(t,"</a>\n        </li>")),1<t?w.paginationList.innerHTML='\n            <li class="ais-Pagination-item ais-Pagination-item--previousPage '.concat(n?"ais-Pagination-item--disabled":"",'">\n              ').concat(n?'<span class="ais-Pagination-link ais-Pagination-link--disabled" aria-label="Previous Page"><i class="fas fa-angle-left"></i></span>':'<a class="ais-Pagination-link" aria-label="Previous Page" href="#" data-page="'.concat(e-1,'"><i class="fas fa-angle-left"></i></a>'),"\n            </li>\n            ").concat(l,'\n            <li class="ais-Pagination-item ais-Pagination-item--nextPage ').concat(a?"ais-Pagination-item--disabled":"",'">\n              ').concat(a?'<span class="ais-Pagination-link ais-Pagination-link--disabled" aria-label="Next Page"><i class="fas fa-angle-right"></i></span>':'<a class="ais-Pagination-link" aria-label="Next Page" href="#" data-page="'.concat(e+1,'"><i class="fas fa-angle-right"></i></a>'),"\n            </li>"):w.pagination.style.display="none"},P=!1,I=document.getElementById("search-mask"),S=document.querySelector("#local-search .search-dialog"),k=function(){btf.overflowPaddingR.remove(),btf.animateOut(S,"search_close .5s"),btf.animateOut(I,"to_hide 0.5s"),window.removeEventListener("resize",y)};window.addEventListener("search:loaded",function(){var e=document.getElementById("loading-database");e.nextElementSibling.style.visibility="visible",e.remove()}),b(),document.querySelector("#local-search .search-close-button").addEventListener("click",k),I.addEventListener("click",k),GLOBAL_CONFIG.localSearch.preload&&o.fetchData(),o.highlightSearchWords(document.getElementById("article-container")),r&&w.pagination.addEventListener("click",function(e){e.preventDefault();e=e.target.closest("a[data-page]");e&&(e=parseInt(e.dataset.page,10),!isNaN(e)&&0<g.length&&(d=e,p(l.value.trim().toLowerCase(),g)))}),f(!1),window.addEventListener("pjax:complete",function(){btf.isHidden(I)||k(),o.highlightSearchWords(document.getElementById("article-container")),b()})});