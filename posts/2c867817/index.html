<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Docker的安装与使用 | ZYKJ's Blog</title><meta name="keywords" content="Docker"><meta name="author" content="ZYKJ"><meta name="copyright" content="ZYKJ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="自己总结有关Docker的安装与使用"><meta property="og:type" content="article"><meta property="og:title" content="Docker的安装与使用"><meta property="og:url" content="https://zykj.js.org/posts/2c867817/index.html"><meta property="og:site_name" content="ZYKJ&#39;s Blog"><meta property="og:description" content="自己总结有关Docker的安装与使用"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/dockerinstall-cover.png"><meta property="article:published_time" content="2020-04-05T02:24:20.000Z"><meta property="article:modified_time" content="2020-07-24T02:20:20.000Z"><meta property="article:author" content="ZYKJ"><meta property="article:tag" content="Docker"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/dockerinstall-cover.png"><link rel="shortcut icon" href="https://gcore.jsdelivr.net/gh/zykjofficial/zykjofficial.github.io@master/img/favicon.ico"><link rel="canonical" href="https://zykj.js.org/posts/2c867817/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="manifest" href="/img/pwa/manifest.json"><link rel="apple-touch-icon" sizes="180x180" href="/img/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/pwa/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/pwa/16.png"><link rel="mask-icon" href="/img/pwa/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zykjofficial/zykjofficial.github.io@master/css/index.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:{limitDay:30,position:"top",messagePrev:"这篇文章已经发表了",messageNext:"天了，其中部分内容可能已经过时。"},highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"top-center"},source:{justifiedGallery:{js:"https://gcore.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://gcore.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Docker的安装与使用",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2020-07-24 10:20:20"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const a=864e5*o,c={value:t,expiry:(new Date).getTime()+a};localStorage.setItem(e,JSON.stringify(c))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const a=document.createElement("script");a.src=e,a.async=!0,a.onerror=o,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};const t=saveToLocal.get("theme"),o=window.matchMedia("(prefers-color-scheme: dark)").matches,a=window.matchMedia("(prefers-color-scheme: light)").matches,c=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!o&&!a&&!c;if(void 0===t){if(a)activateLightMode();else if(o)activateDarkMode();else if(c||n){const e=(new Date).getHours();e<=6||e>=18?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener((function(e){void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())}))}else"light"===t?activateLightMode():activateDarkMode();const i=saveToLocal.get("aside-status");void 0!==i&&("hide"===i?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><style>.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/zykjofficial/zykjofficial.github.io@master/css/zykjcss.css" media="all" onload='this.media="all",this.onload=null'><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="ZYKJ's Blog" type="application/atom+xml"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjofficial.github.io@master/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-house-user"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-book"></i> <span>文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="/random_post/"><i class="fa-fw fas fa-random"></i> <span>随机文章</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-th-list"></i> <span>娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa fa-film"></i> <span>番剧</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fa fa-image"></i> <span>相册</span></a></li><li><a class="site-page child" href="/baidu/"><i class="fa-fw fa-fw fab fa-html5"></i> <span>百度</span></a></li><li><a class="site-page child" href="/random/"><i class="fa-fw fas fa-random"></i> <span>选人</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-gamepad"></i> <span>游戏</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/game/arknights/"><i class="fa-fw fa fa-mobile"></i> <span>明日方舟</span></a></li><li><a class="site-page child" href="/catchcat/"><i class="fa-fw fa fa-cat"></i> <span>圈小猫</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-envelope"></i> <span>消息</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/message/"><i class="fa-fw fa fa-comments"></i> <span>留言板</span></a></li><li><a class="site-page child" href="/timeline/"><i class="fa-fw fa fa-calendar-alt"></i> <span>时间线</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-info-circle"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/dockerinstall-cover.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ZYKJ's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-house-user"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-book"></i> <span>文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="/random_post/"><i class="fa-fw fas fa-random"></i> <span>随机文章</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-th-list"></i> <span>娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa fa-film"></i> <span>番剧</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fa fa-image"></i> <span>相册</span></a></li><li><a class="site-page child" href="/baidu/"><i class="fa-fw fa-fw fab fa-html5"></i> <span>百度</span></a></li><li><a class="site-page child" href="/random/"><i class="fa-fw fas fa-random"></i> <span>选人</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-gamepad"></i> <span>游戏</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/game/arknights/"><i class="fa-fw fa fa-mobile"></i> <span>明日方舟</span></a></li><li><a class="site-page child" href="/catchcat/"><i class="fa-fw fa fa-cat"></i> <span>圈小猫</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-envelope"></i> <span>消息</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/message/"><i class="fa-fw fa fa-comments"></i> <span>留言板</span></a></li><li><a class="site-page child" href="/timeline/"><i class="fa-fw fa fa-calendar-alt"></i> <span>时间线</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-info-circle"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker的安装与使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-04-05T02:24:20.000Z" title="发表于 2020-04-05 10:24:20">2020-04-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-07-24T02:20:20.000Z" title="更新于 2020-07-24 10:20:20">2020-07-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Docker%E6%95%99%E7%A8%8B/">Docker教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>32分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Docker的安装与使用"><a href="#Docker的安装与使用" class="headerlink" title="Docker的安装与使用"></a>Docker的安装与使用</h2><blockquote><p>什么是Docker？</p></blockquote><div class="note info flat"><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.docker.com/">Docker</a> 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。<br>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。<br>容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）, 更重要的是容器性能开销极低。</p><p>关键字：<code>容器虚拟化技术</code></p></div><h3 id="需要准备"><a href="#需要准备" class="headerlink" title="需要准备"></a>需要准备</h3><ul><li>Centos7.x系统、64位系统、内核版本3.10以上 <code>或</code> Centos6.5以上系统、64位系统、内核版本2.6.32以上</li><li>Centos必须能够联网</li></ul><p>如何查看Liunx系统内核?</p><div class="hide-block"><button type="button" class="hide-button">点击查看</button><div class="hide-content"><ul><li><p>Centos7.x查看方法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -r</span><br></pre></td></tr></table></figure></li><li><p>Centos6.x查看方法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/redhat-release</span><br></pre></td></tr></table></figure></li></ul></div></div><p>如果满足了上面的条件、我们现在就开始吧！</p><h2 id="Docker概念"><a href="#Docker概念" class="headerlink" title="Docker概念"></a>Docker概念</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200328161635.png"></p><p><code>docker主机(Host)：</code>安装了Docker程序的机器（Docker直接安装在操作系统之上）；<br><code>docker客户端(Client)：</code>连接docker主机进行操作；<br><code>docker仓库(Registry)：</code>用来保存各种打包好的软件镜像；<br><code>docker镜像(Images)：</code>软件打包好的镜像；放在docker仓库中；<br><code>docker容器(Container)：</code>镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用；</p><h3 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h3><p>Centos7.x安装</p><div class="hide-block"><button type="button" class="hide-button">点击查看</button><div class="hide-content"><ol><li><p>需要提前安装的必备组件: gcc gcc-c++ (如果安装了可以忽略)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc</span><br><span class="line">yum -y install gcc-c++</span><br></pre></td></tr></table></figure></li><li><p>卸载旧版本Docker (如果没有安装可以忽略)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove docker docker-common docker-selinux docker-engine</span><br></pre></td></tr></table></figure></li><li><p>安装需要的软件包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-peristent-data lvm2 </span><br></pre></td></tr></table></figure><p>如果yum被其他进程占用、 <code>ps -ef|grep yum</code> 查看占用进程 <code>kill -9 占用的端口号</code> 就可以了。</p></li><li><p>设置镜像仓库地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li><li><p>更新yum软件包索引</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure></li><li><p>安装Docker CE</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure></li><li><p>启动Docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker //启动Docker</span><br><span class="line">systemctl status docker //查看启动状态</span><br></pre></td></tr></table></figure></li><li><p>其他</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker version //查看版本</span><br><span class="line">docker run hello-world //运行helloworld镜像(没有会从远程仓库pull)</span><br><span class="line"></span><br><span class="line">卸载</span><br><span class="line">systemctl stop docker</span><br><span class="line">yum -y remove docker-re</span><br><span class="line"><span class="built_in">rm</span> -rf /var/lib/docker</span><br></pre></td></tr></table></figure></li></ol></div></div><p><strong>Centos6.8安装</strong></p><div class="hide-block"><button type="button" class="hide-button">点击查看</button><div class="hide-content"><ol><li><p>yum install -y epel-release</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Docker使用EPEL发布，RHEL系的OS首先要确保已经持有EPEL仓库，否则先检查OS的版本，然后安装相应的EPEL包。</span><br></pre></td></tr></table></figure></li><li><p>yum install -y docker-io</p></li><li><p>安装后的配置文件： &#x2F;etc&#x2F;sysconfig&#x2F;docker</p></li><li><p>启动Docker后台服务： service docker start</p></li><li><p>docker version验证</p></li></ol></div></div><h3 id="配置镜像加速"><a href="#配置镜像加速" class="headerlink" title="配置镜像加速"></a>配置镜像加速</h3><blockquote><p>使用阿里云镜像加速(<a target="_blank" rel="noopener external nofollow noreferrer" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a>)</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200328174602.png"></p><div class="hide-block"><button type="button" class="hide-button">Centos配置方法</button><div class="hide-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/docker //创建多级目录</span><br><span class="line">vim /etc/docker/daemon.json //编辑镜像地址</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;粘贴你的镜像加速地址&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload //刷新配置</span><br><span class="line">systemctl restart docker //重启Docker</span><br></pre></td></tr></table></figure></div></div><h2 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><ol><li><p><strong>docker version &#x2F;&#x2F;Docker版本</strong></p></li><li><p><strong>docker info &#x2F;&#x2F;Docker详细信息</strong></p></li><li><p><strong>docker help &#x2F;&#x2F;Docker命令信息</strong></p></li></ol><h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><ol><li><p><strong>docker images &#x2F;&#x2F;列出本地主机上的镜像</strong></p><table><thead><tr><th align="left">REPOSITORY</th><th align="left">TAG</th><th align="left">IMAGE ID</th><th align="left">CREATED</th><th align="left">SIZE</th></tr></thead><tbody><tr><td align="left">表示镜像的仓库源</td><td align="left">镜像的标签</td><td align="left">镜像ID</td><td align="left">镜像创建时间</td><td align="left">镜像大小</td></tr></tbody></table><p><strong>可加参数：</strong></p><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>-a</code></td><td align="left">列出本地所有的镜像(含中间映像层)</td></tr><tr><td align="left"><code>-q</code></td><td align="left">只显示镜像ID</td></tr><tr><td align="left"><code>--digests</code></td><td align="left">只显示镜像的摘要信息</td></tr><tr><td align="left"><code>--no-trunc</code></td><td align="left">显示完整的镜像信息</td></tr></tbody></table></li><li><p><strong>docker search 镜像名字 &#x2F;&#x2F;从云端查询指定镜像</strong></p><table><thead><tr><th align="left">NAME</th><th align="left">DESCRIPTION</th><th align="left">OFFICIAL</th><th align="left">STARTS</th><th align="left">AUTOMATED</th></tr></thead><tbody><tr><td align="left">镜像仓库源的名称</td><td align="left">镜像的描述</td><td align="left">是否 docker 官方发布</td><td align="left">类似 Github 里面的 star，表示点赞、喜欢的意思</td><td align="left">自动构建</td></tr></tbody></table><p>官网：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://hub.docker.com/">https://hub.docker.com/</a></p><p><strong>可加参数：</strong></p><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>--no-trunc</code></td><td align="left">显示完整的镜像描述</td></tr><tr><td align="left"><code>-s 数字</code></td><td align="left">列出收藏数不小于指定值的镜像)</td></tr><tr><td align="left"><code>--automated</code></td><td align="left">只列出 <code>automated bulid</code> 类型的镜像</td></tr></tbody></table></li><li><p><strong>docker pull 镜像名字[:TAG] &#x2F;&#x2F;从云端下载指定镜像</strong></p></li><li><p><strong>docker rmi 镜像ID &#x2F;&#x2F;删除本地指定镜像</strong></p><p><strong>可加参数：</strong></p><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>-f</code></td><td align="left">强制删除某个镜像 例：docker rmi -f fce289e99eb9</td></tr><tr><td align="left"><code>-f 镜像名1:TAG 镜像名2:TAG</code></td><td align="left">强制删除多个镜像 例：docker rmi -f hello-world tomcat</td></tr><tr><td align="left"><code>-f $(docker images -qa)</code></td><td align="left">强制删除所有本地镜像</td></tr></tbody></table></li></ol><h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><ol><li><p><strong>docker run [OPTIONS] <code>IMAGE</code> [COMMAND] [ARG…] &#x2F;&#x2F;新建并启动容器</strong></p><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>--name=&quot;容器新名字&quot;</code></td><td align="left">为容器指定一个名字</td></tr><tr><td align="left"><code>-d</code></td><td align="left">后台运行容器，并返回容器ID，也启动守护式容器</td></tr><tr><td align="left"><code>-i</code></td><td align="left">以交互模式运行容器，通常与 -t 同时运行</td></tr><tr><td align="left"><code>-t</code></td><td align="left">为容器重新分配一个伪输入终端，通常与 -i 同时运行</td></tr><tr><td align="left"><code>-P</code></td><td align="left">随机端口映射</td></tr><tr><td align="left"><code>-p</code></td><td align="left">指定端口映射，有以下四种格式:</td></tr><tr><td align="left"></td><td align="left">ip:hostPort:containerPort</td></tr><tr><td align="left"></td><td align="left">ip::containerPort</td></tr><tr><td align="left"></td><td align="left">hostPort:containerPort 主机端口:容器端口</td></tr><tr><td align="left"></td><td align="left">containerPort</td></tr></tbody></table></li><li><p><strong>docker ps [OPTIONS] &#x2F;&#x2F;列出当前所有正在运行的容器</strong></p><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>-a</code></td><td align="left">列出当前所有<code>正在运行的容器</code>+<code>历史上运行过的</code></td></tr><tr><td align="left"><code>-l</code></td><td align="left">显示最近创建的容器</td></tr><tr><td align="left"><code>-n</code></td><td align="left">显示最近n个创建的容器 例：docker ps -n 3</td></tr><tr><td align="left"><code>-q</code></td><td align="left"><code>静默模式，只显示容器编号</code></td></tr><tr><td align="left"><code>--no-trunc</code></td><td align="left">随机端口映射</td></tr></tbody></table></li><li><p><strong>退出容器</strong></p><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>exit</code></td><td align="left">容器停止退出</td></tr><tr><td align="left"><code>Ctrl+P+Q</code></td><td align="left">容器不停止退出</td></tr></tbody></table></li><li><p><strong>docker start 容器ID或者容器名 &#x2F;&#x2F;启动容器</strong></p></li><li><p><strong>docker restart 容器ID或者容器名 &#x2F;&#x2F;重启容器</strong></p></li><li><p><strong>docker stop 容器ID或者容器名 &#x2F;&#x2F;停止容器</strong></p></li><li><p><strong>docker kill 容器ID或者容器名 &#x2F;&#x2F;强制停止容器</strong></p></li><li><p><strong>docker rm 容器ID &#x2F;&#x2F;删除已经停止容器</strong></p><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>docker rm -f $(docker ps -a -q)</code></td><td align="left">一次性删除多个容器</td></tr><tr><td align="left"><code>docker ps -a -q｜xargs docker rm</code></td><td align="left">容器不停止退出</td></tr></tbody></table></li><li><p><strong>docker commit 提交容器副本使之成为一个新的镜像</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m=<span class="string">&quot;提交的描述信息&quot;</span> -a=<span class="string">&quot;作者&quot;</span> 容器ID 要创建的目标镜像名[:标签名]</span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>-a</code></td><td align="left">提交的镜像作者</td></tr><tr><td align="left"><code>-c</code></td><td align="left">使用Dockerfile指令来创建镜像</td></tr><tr><td align="left"><code>-m</code></td><td align="left">提交时的说明文字</td></tr><tr><td align="left"><code>-p</code></td><td align="left">在commit时，将容器暂停</td></tr></tbody></table></li><li><p><strong>docker inspect 镜像ID &#x2F;&#x2F;获取容器&#x2F;镜像的元数据、返回一个 JSON 文件记录着 Docker 容器的配置和状态信息。</strong></p><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>-f</code></td><td align="left">指定返回值的模板文件</td></tr><tr><td align="left"><code>-s</code></td><td align="left">显示总的文件大小</td></tr><tr><td align="left"><code>--type</code></td><td align="left">为指定类型返回JSON</td></tr></tbody></table></li></ol><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol><li><p><strong>启动守护式容器</strong></p><p><code>docker run -d 容器名</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用镜像centos:latest以后台模式启动一个容器</span><br><span class="line"></span><br><span class="line">docker run -d centos</span><br><span class="line"></span><br><span class="line">问题:然后docker ps -a进行查看,会发现容器已经退出</span><br><span class="line"></span><br><span class="line">很重要的要说明的一点:Docker容器后台运行就必须有一个前台进程</span><br><span class="line"></span><br><span class="line">容器运行的命令如果不是那些一直挂起的命令(比如运行top,tail),就是会自动退出的。</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d centos /bin/sh -C <span class="string">&quot;while true;do echo hello zykj;sleep 2;done&quot;</span></span><br><span class="line">启动时给centos一些参数、可以让容器不停止运行、死循环输出日志</span><br></pre></td></tr></table></figure></li><li><p><strong>查看容器日志</strong></p><ul><li><p>docker logs -f -t –tail 容器ID</p><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>-t</code></td><td align="left">是加入时间戳</td></tr><tr><td align="left"><code>-f</code></td><td align="left">跟随最新的日志打印</td></tr><tr><td align="left"><code>--tail</code></td><td align="left">数字显示最后多少条</td></tr></tbody></table></li></ul></li><li><p><strong>查看容器内运行的进程</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top 容器ID </span><br></pre></td></tr></table></figure></li><li><p><strong>进入正在运行的容器以命令行交互</strong></p><ul><li><p>docker exec -it 容器ID bashShell &#x2F;&#x2F;不进入容器里执行容器命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">以Centos为例:</span><br><span class="line">docker <span class="built_in">exec</span> -it 容器ID <span class="built_in">ls</span> -l /tmp </span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -it 容器ID /bin/bash //进入交互模式</span><br></pre></td></tr></table></figure></li><li><p>重新进入docker attach 容器ID</p></li></ul><p><strong>区别：</strong></p><p><code>exec</code>: 是在容器中打开新的终端，并且可以启动新的进程<br><code>attach</code>: 直接进入容器启动命令的终端，不会启动新的进程</p></li><li><p><strong>从容器内拷贝文件到主机上</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> 容器ID:容器内路径目的主机路径</span><br></pre></td></tr></table></figure></li></ol><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200402170142.png"></p><div class="hide-block"><button type="button" class="hide-button">更多命令</button><div class="hide-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">attach    Attach to a running container                 # 当前 shell 下 attach 连接指定运行镜像</span><br><span class="line">build     Build an image from a Dockerfile              # 通过 Dockerfile 定制镜像</span><br><span class="line">commit    Create a new image from a container changes   # 提交当前容器为新的镜像</span><br><span class="line">cp        Copy files/folders from the containers filesystem to the host path   #从容器中拷贝指定文件或者目录到宿主机中</span><br><span class="line">create    Create a new container                        # 创建一个新的容器，同 run，但不启动容器</span><br><span class="line">diff      Inspect changes on a container&#x27;s filesystem   # 查看 docker 容器变化</span><br><span class="line">events    Get real time events from the server          # 从 docker 服务获取容器实时事件</span><br><span class="line">exec      Run a command in an existing container        # 在已存在的容器上运行命令</span><br><span class="line">export    Stream the contents of a container as a tar archive   # 导出容器的内容流作为一个 tar 归档文件[对应 import ]</span><br><span class="line">history   Show the history of an image                  # 展示一个镜像形成历史</span><br><span class="line">images    List images                                   # 列出系统当前镜像</span><br><span class="line">import    Create a new filesystem image from the contents of a tarball # 从tar包中的内容创建一个新的文件系统映像[对应export]</span><br><span class="line">info      Display system-wide information               # 显示系统相关信息</span><br><span class="line">inspect   Return low-level information on a container   # 查看容器详细信息</span><br><span class="line">kill      Kill a running container                      # kill 指定 docker 容器</span><br><span class="line">load      Load an image from a tar archive              # 从一个 tar 包中加载一个镜像[对应 save]</span><br><span class="line">login     Register or Login to the docker registry server    # 注册或者登陆一个 docker 源服务器</span><br><span class="line">logout    Log out from a Docker registry server          # 从当前 Docker registry 退出</span><br><span class="line">logs      Fetch the logs of a container                 # 输出当前容器日志信息</span><br><span class="line">port      Lookup the public-facing port which is NAT-ed to PRIVATE_PORT    # 查看映射端口对应的容器内部源端口</span><br><span class="line">pause     Pause all processes within a container        # 暂停容器</span><br><span class="line">ps        List containers                               # 列出容器列表</span><br><span class="line">pull      Pull an image or a repository from the docker registry server   # 从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line">push      Push an image or a repository to the docker registry server    # 推送指定镜像或者库镜像至docker源服务器</span><br><span class="line">restart   Restart a running container                   # 重启运行的容器</span><br><span class="line">rm        Remove one or more containers                 # 移除一个或者多个容器</span><br><span class="line">rmi       Remove one or more images             # 移除一个或多个镜像[无容器使用该镜像才可删除，否则需删除相关容器才可继续或 -f 强制删除]</span><br><span class="line">run       Run a command in a new container              # 创建一个新的容器并运行一个命令</span><br><span class="line">save      Save an image to a tar archive                # 保存一个镜像为一个 tar 包[对应 load]</span><br><span class="line">search    Search for an image on the Docker Hub         # 在 docker hub 中搜索镜像</span><br><span class="line">start     Start a stopped containers                    # 启动容器</span><br><span class="line">stop      Stop a running containers                     # 停止容器</span><br><span class="line">tag       Tag an image into a repository                # 给源中镜像打标签</span><br><span class="line">top       Lookup the running processes of a container   # 查看容器中运行的进程信息</span><br><span class="line">unpause   Unpause a paused container                    # 取消暂停容器</span><br><span class="line">version   Show the docker version information           # 查看 docker 版本号</span><br><span class="line">wait      Block until a container stops, then print its exit code   # 截取容器停止时的退出状态值</span><br></pre></td></tr></table></figure></div></div><h2 id="Docker容器数据卷"><a href="#Docker容器数据卷" class="headerlink" title="Docker容器数据卷"></a>Docker容器数据卷</h2><blockquote><p>docker的理念将运行的环境打包形成容器运行，运行可以伴随容器，但是我们对数据的要求是希望持久化，容器之间可以共享数据，Docker容器产生的数据，如果不通过docker commit生成新的镜像，使得数据作为容器的一部分保存下来，那么当容器被删除之后，数据也就没了，为了能够保存数据，在docker容器中使用卷。卷就是目录或者文件，存在于一个或者多个容器中，但是不属于联合文件系统，因此能够绕过Union File System提供一些用于持久化数据或共享数据的特点。<br>关键字: <code>容器的持久化</code>、<code>容器间继承+共享数据</code></p></blockquote><h3 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h3><h4 id="容器内添加"><a href="#容器内添加" class="headerlink" title="容器内添加"></a>容器内添加</h4><h5 id="直接命令添加"><a href="#直接命令添加" class="headerlink" title="直接命令添加"></a>直接命令添加</h5><ul><li><p>命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /宿主机绝对路径目录:/容器内目录 镜像名</span><br><span class="line"></span><br><span class="line">例：(ps:目录不存在会自动创建)</span><br><span class="line">docker run -it -v /myDataVolume:/dataVolumeContianer centos </span><br><span class="line"></span><br><span class="line">通过docker inspect查看</span><br><span class="line"><span class="string">&quot;VolimesRW&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;/dataVolumeContainer&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">Docker挂载主机目录Docker访问出现cannot open directory : Permission denied</span><br><span class="line">解决办法:在挂载目录后多加一个--privileged=<span class="literal">true</span>参数即可</span><br></pre></td></tr></table></figure></li><li><p>容器和宿主机之间会数据共享</p></li><li><p>容器停止退出后，主机修改后数据同样数据同步</p></li><li><p>命令(带权限：主机目录创建文件、容器目录只读)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /宿主机绝对路径目录:/容器内目录:ro镜像名</span><br><span class="line"></span><br><span class="line">通过docker inspect查看</span><br><span class="line"><span class="string">&quot;VolimesRW&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;/dataVolumeContainer&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li></ul><h5 id="Dockerfile添加"><a href="#Dockerfile添加" class="headerlink" title="Dockerfile添加"></a>Dockerfile添加</h5><ul><li><p>根目录(其他目录也可以)下新建mydocker文件夹并进入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /</span><br><span class="line"><span class="built_in">mkdir</span> mydocker</span><br></pre></td></tr></table></figure></li><li><p>可在Dockerfile中使用VOLUME指令来给镜像添加一个或多个数据卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VOLUME[<span class="string">&quot;/dataVolumeContainer&quot;</span>,<span class="string">&quot;/dataVolumeContainer2&quot;</span>,<span class="string">&quot;/dataVolumeContainer3&quot;</span>]</span><br><span class="line"></span><br><span class="line">说明:</span><br><span class="line">出于可移植和分享的考虑，用 -v主机目录:容器目录这种方法不能够直接在Dockerfile中实现。</span><br><span class="line">由于宿主机目录是依赖于特定宿主机的，并不能够保证在所有的宿主机上都存在这样的特定目录。</span><br></pre></td></tr></table></figure></li><li><p>File构建</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim Dockerfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># volume test</span></span><br><span class="line">FROM centos</span><br><span class="line">VOLUME [<span class="string">&quot;/dataVolumeContainer1&quot;</span>,<span class="string">&quot;/dataVolumeContainer2&quot;</span>]</span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;Hello,-----world!&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line">通过docker命令解释就是：</span><br><span class="line">docker run -it -V /host1: /dataVolumeContainer1 -v /host2:/dataVolumeContainer2 centos /bin/bash</span><br></pre></td></tr></table></figure></li><li><p>build后生成镜像 获得一个新镜像zykj&#x2F;centos</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build -f /mydocker/Dockerfile -t zykj/centos .</span><br><span class="line"></span><br><span class="line">-f :指定要使用的Dockerfile路径；</span><br><span class="line">--tag, -t: 镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签。</span><br><span class="line">. :当前目录</span><br></pre></td></tr></table></figure></li><li><p>run容器</p></li></ul><h3 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h3><blockquote><p>命名的容器挂载数据卷，其它容器通过挂载这个(父容器)实现数据共享，挂载数据卷的容器，称之为数据卷容器</p></blockquote><h4 id="容器间数据共享-volumes-from"><a href="#容器间数据共享-volumes-from" class="headerlink" title="容器间数据共享 - -volumes-from"></a>容器间数据共享 - -volumes-from</h4><ul><li><p>命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name 子容器 --volumes-from 父容器 zykj/centos</span><br></pre></td></tr></table></figure></li><li><p>结论:容器之间配置信息的传递，数据卷的生命周期一直持续到没有容器使用它为止</p></li></ul><h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><blockquote><p>Dockerfile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。</p></blockquote><h3 id="构建三个步骤"><a href="#构建三个步骤" class="headerlink" title="构建三个步骤"></a>构建三个步骤</h3><ul><li>编写Dockerfile文件</li><li>docker build</li><li>docker run</li></ul><h3 id="Dockerfile构建过程解析"><a href="#Dockerfile构建过程解析" class="headerlink" title="Dockerfile构建过程解析"></a>Dockerfile构建过程解析</h3><p><strong>Dockerfile内容基础知识</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">每条保留字指令都必须为大写字母且后面要跟随至少一个参数</span><br><span class="line">指令按照从上到下，顺序执行</span><br><span class="line">#表示注释</span><br><span class="line">每条指令都会创建一一个新的镜像层，并对镜像进行提交</span><br></pre></td></tr></table></figure><h3 id="Docker执行Dockerfile的大致流程"><a href="#Docker执行Dockerfile的大致流程" class="headerlink" title="Docker执行Dockerfile的大致流程"></a>Docker执行Dockerfile的大致流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker从基础镜像运行一个容器</span><br><span class="line">执行一条指令并对容器作出修改</span><br><span class="line">执行类似docker commit的操作提交-一个新的镜像层</span><br><span class="line">docker再基于刚提交的镜像运行一个新容器</span><br><span class="line">执行dockerfile中的下一条指令直到所有指令都执行完成</span><br></pre></td></tr></table></figure><p>总结：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉 及的内容包括执行代码或者是文件、环境</span><br><span class="line">变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，</span><br><span class="line">这时需要考虑如何设计namespace的权限控制)等等;</span><br><span class="line">Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行Docker镜像时，会真正开始提供服务;</span><br><span class="line">Docker容器，容器是直接提供服务的。</span><br></pre></td></tr></table></figure><h3 id="Docker体系结构-保留字指令"><a href="#Docker体系结构-保留字指令" class="headerlink" title="Docker体系结构(保留字指令)"></a>Docker体系结构(保留字指令)</h3><ul><li><p><code>FROM</code> 基础镜像，当前新镜像是基于哪个镜像的</p></li><li><p><code>MAINTAINER</code> 镜像维护者的姓名和邮箱地址</p></li><li><p><code>RUN</code> 容器构建时需要运行的命令</p></li><li><p><code>EXPOSE</code> 当前容器对外暴露出的端口</p></li><li><p><code>WORKDIR</code> 指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点(就是工作目录)</p></li><li><p><code>ENV</code> 用来在构建镜像过程中设置环境变量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ENV MY_PATH /usr/mytest</span><br><span class="line"> </span><br><span class="line">这个环境变量可以在后续的任何RUN指令中使用，这就如同在命令前面指定了环境变量前缀一样;</span><br><span class="line">也可以在其它指令中直接使用这些环境变量</span><br><span class="line"></span><br><span class="line">比如: WORKDIR $MY_PATH </span><br></pre></td></tr></table></figure></li><li><p><code>ADD</code> 将宿主机目录下的文件拷贝进镜像且ADD命令会 <code>自动处理URL</code> 和 <code>解压tar压缩包</code>，类似ADD，拷贝文件和目录到镜像中。</p></li><li><p><code>COPY</code> 将从构建上下文目录中&lt;源路径&gt;的文件&#x2F;目录复制到新的一层的镜像内的&lt;目标路径&gt;位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">两种方法：</span><br><span class="line">COPY src dest</span><br><span class="line">COPY [&quot;src&quot;,&quot;dest&quot;]</span><br></pre></td></tr></table></figure></li><li><p><code>VOLUME</code> 容器数据卷， 用于数据保存和持久化工作</p></li><li><p><code>CMD</code></p><ul><li><p>Dockerfile中可以有多个CMD指令，但<code>只有最后一个生效</code>，<code>CMD 会被docker run之后的参数替换</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CMD容器启动命令</span><br><span class="line">CMD指令的格式和RUN相似，也是两种格式:</span><br><span class="line"></span><br><span class="line">● shell格式: CMD &lt;命令&gt;</span><br><span class="line">● exec格式: CMD [&quot;可执行文件&quot;，&quot;参数1&quot;， &quot;参数2&quot; ...]</span><br><span class="line">● 参数列表格式: CMD [&quot;参数1&quot;，&quot;参数2&quot;...]。在指定了 ENTRYPOINT 指令后，用 CMD 指定具体的参数。</span><br></pre></td></tr></table></figure></li><li><p>指定一个容器启动时要运行的命令口</p></li></ul></li><li><p><code>ENTRYPOINT</code></p><ul><li>指定一个容器启动时要运行的命令</li><li>ENTRYPOINT的目的和CMD一样，都是在指定容器启动程序及参数</li></ul></li><li><p><code>ONBUILD</code> 当构建一个被继承的Dockerfile时运行命令，父镜像在被子继承后父镜像的onbuild被触发</p></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200401115745.png"></p><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><h4 id="Base镜像-scratch"><a href="#Base镜像-scratch" class="headerlink" title="Base镜像(scratch)"></a><code>Base镜像(scratch)</code></h4><p>DockerHub中99%的镜像都是通过在base镜像中安装和配置需要的软件构建出来的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br><span class="line">docker run -it centos /bin/bash</span><br></pre></td></tr></table></figure><h4 id="自定义镜像mycentos"><a href="#自定义镜像mycentos" class="headerlink" title="自定义镜像mycentos"></a><code>自定义镜像mycentos</code></h4><ul><li>编写<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim Dockerfile</span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER zykj&lt;zykj@zykj.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;success-------------ok&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure></li><li>构建<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build 镜像名字:TAG .</span><br><span class="line">       </span><br><span class="line">例：docker build -f /mydocker/Dockerfile mycentos:1.3 .</span><br></pre></td></tr></table></figure></li><li>运行<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it 镜像名字:TAG</span><br></pre></td></tr></table></figure></li><li>列出镜像的变更历史<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker history 镜像ID</span><br></pre></td></tr></table></figure></li></ul><h4 id="CMD-ENTRYPOINT案例"><a href="#CMD-ENTRYPOINT案例" class="headerlink" title="CMD/ENTRYPOINT案例"></a><code>CMD/ENTRYPOINT案例</code></h4><ul><li>都是指定一个容器启动时要运行的命令</li><li>CMD<ul><li>Dockerfile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换</li><li>运行tomcat docker run -it -p 8888:8080 tomcat ls -l</li></ul></li></ul><p>-ENTRYPOINT<br>- docker run之后的参数会被当做参数传递给ENTRYPOINT，之后形成新的命令组合<br>- 例子<br>- 制作 <code>CMD</code> 版可以查询IP信息的容器(<code>curl直接访问http://ip.cn会报403、所以。。。以下告诉方法</code>)<br></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">RUN yum install -y curl</span><br><span class="line">CMD [ &quot;curl&quot; , &quot;-s&quot; , &quot;http://ip.cn&quot; ]</span><br></pre></td></tr></table></figure><br><strong>curl命令解释</strong><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl命令可以用来执行下载、发送各种HTTP请求，指定HTTP头部等操作。</span><br><span class="line">如果系统没有curl可以使用yum install curl安装，也可以下载安装。</span><br><span class="line">curl是将下载文件输出到stdout</span><br><span class="line"></span><br><span class="line">使用命令: curl http://www.baidu.com</span><br><span class="line">执行后，www.baidu.com的html就会显示在屏幕上了</span><br><span class="line"></span><br><span class="line">这是最简单的使用方法。用这个命令获得了http://curl.haxx.se指向的页面，同样，如果这里的URL指向的是一个文件</span><br><span class="line">或者一幅图都可以直接下载到本地。如果下载的是HTML文档，那么缺省的将只显示文件头部，即HTML文档的</span><br><span class="line">header。要全部显示，请加参数 -i</span><br></pre></td></tr></table></figure><br>- 问题 如果我们希望显示HTTP头信息，就需要加上i参数、docker run myip -i 但是会报错<br>- WHY<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">我们可以看到可执行文件找不到的报错，executable file not found。 </span><br><span class="line">之前我们说过，跟在镜像名后面的是command,运行时会替换CMD的默认值。</span><br><span class="line">因此这里的-i替换了原来的CMD，而不是添加在原来的curl -s htp://ip.cn 后面。而-i根本不是命令，所以自然找不到。</span><br><span class="line"></span><br><span class="line">那么如果我们希望加入-i这参数，我们就必须重新完整的输入这个命令:</span><br><span class="line"></span><br><span class="line">docker run myip curl -s http://ip.cn -i</span><br></pre></td></tr></table></figure><br>- 制作 <code>ENTROYPOINT</code> 版查询IP信息的容器<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">RUN yum install -y curl</span><br><span class="line">ENTROYPOINT [ &quot;curl&quot; , &quot;-s&quot; , &quot;http://ip.cn&quot; ]</span><br></pre></td></tr></table></figure><br>通过使用ENTROYPOINT可以执行docker run myip -i、-i作为参数追加<p></p><h4 id="自定义Tomcat9镜像"><a href="#自定义Tomcat9镜像" class="headerlink" title="自定义Tomcat9镜像"></a><code>自定义Tomcat9镜像</code></h4><ol><li><p><code>mkdir -p /zykjuse/mydockerfile/tomcat9</code></p></li><li><p>在上述目录下 <code>touch c.txt</code></p></li><li><p>将 <code>jdk</code> 和 <code>tomcat</code> 安装的压缩包拷贝进上一步目录</p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://archive.apache.org/dist/tomcat/tomcat-9/v9.0.8/bin/">apache-tomcat-9.0.8.tar.gz</a><br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://download.huihoo.com/java/javase/8/">jdk-8u171-linux-x64.tar.gz</a></p></li><li><p>在&#x2F;zzkjuse&#x2F;mydockerfile&#x2F;tomcat9目录下新建Dockerfile文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER zykj&lt;zykj@zykj.com&gt;</span><br><span class="line">#把宿主机当前上下文的c.txt拷贝到容器/usr/local/路径下</span><br><span class="line">COPY c.txt /usr/local/cincontainer.txt</span><br><span class="line">#把java与tomcat添加到容器中</span><br><span class="line">ADD jdk-8u171-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.8.tar.gz /usr/local/</span><br><span class="line">#安装vim编辑器</span><br><span class="line">RUN yum -y install vim</span><br><span class="line">#设置工作访问时候的WORKDIR路径，登录落脚点</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line">#配置java与tomcat环境变量</span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_171</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.8</span><br><span class="line">ENV CATALINA_BASE /usr/local/apache-tomcat-9.0.8</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line">#容器运行时监听的端口</span><br><span class="line">EXPOSE  8080</span><br><span class="line">#启动时运行tomcat</span><br><span class="line"># ENTRYPOINT [&quot;/usr/local/apache-tomcat-9.0.8/bin/startup.sh&quot; ]</span><br><span class="line"># CMD [&quot;/usr/local/apache-tomcat-9.0.8/bin/catalina.sh&quot;,&quot;run&quot;]</span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.8/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.8/bin/logs/catalina.out</span><br></pre></td></tr></table></figure></li><li><p>构建</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t zykjtomcat9 .</span><br><span class="line">ps:如果Dockerfile在当前目录内可以不指定</span><br></pre></td></tr></table></figure></li><li><p>运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9080:8080 --name myt9 -v /zzyyuse/mydockerfile/tomcat9/test:/usr/local/apache-tomcat-9.0.8/webapps/test -v /zzyyuse/mydockerfile/tomcat9/tomcat9logs/:/usr/local/apache-tomcat-9.0.8/logs --privileged=<span class="literal">true</span> zykjtomcat9</span><br></pre></td></tr></table></figure></li><li><p>结合前述容器卷将测试的web服务test发布</p><ul><li><p>在&#x2F;zykjuse&#x2F;mydockerfile&#x2F;tomcat9下创建test目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> <span class="built_in">test</span></span><br></pre></td></tr></table></figure></li><li><p>编写 <code>a.jsp</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim a.jsp</span><br><span class="line"></span><br><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">-----------welcome------------</span><br><span class="line">&lt;%=<span class="string">&quot;i am in docker tomcat self &quot;</span>%&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;% System.out.println(<span class="string">&quot;=============docker tomcat self&quot;</span>);%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li><li><p>在当前创建WEB-INF目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> WEB-INF</span><br></pre></td></tr></table></figure></li><li><p>编写<code>web.xml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim web.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span><br><span class="line">id=&quot;WebApp_ID&quot; version=&quot;2.5&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;display-name&gt;test&lt;/display-name&gt;</span><br><span class="line"></span><br><span class="line">&lt;/web-app&gt;</span><br><span class="line"></span><br><span class="line">最后重启容器访问 localhost:9080/test/a.jsp就可以了</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="小总结"><a href="#小总结" class="headerlink" title="小总结"></a>小总结</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200402165812.png"></p><h2 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h2><h3 id="安装Tomcat"><a href="#安装Tomcat" class="headerlink" title="安装Tomcat"></a>安装Tomcat</h3><ol><li>docker hub上面查找tomcat镜像(<code>docker search tomcat</code>)</li><li>从docker hub上拉取tomcat镜像到本地(<code>docker pull tomcat</code>)</li><li><code>docker images</code>查看是否有拉取到的tomcat</li><li>使用tomcat镜像创建容器(也叫运行镜像) (<code>docker run -it -p 8080:8080 tomcat</code>)<ul><li><code>-p</code> : 主机端口:docker容器端口</li><li><code>-P</code> : 随机分配端口D</li><li><code>-i</code> : 交互</li><li><code>-t</code> : 终端</li></ul></li></ol><h3 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h3><ol><li>docker hub上面查找mysql镜像</li><li>从docker hub上(阿里云加速器)拉取mysql镜像到本地标签为5.7</li><li>使用mysql5.7镜像创建容器(也叫运行镜像)<ul><li>使用mysql镜像<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3306:3306 --name mysql -v /zykjuse/mysql/conf:/etc/mysql/conf.d -v /zzyyuse/mysql/logs:/logs -v /zykjuse/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br></pre></td></tr></table></figure>命令说明：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-p 3306:3306：将主机的3306端口映射到docker容器的3306端口。</span><br><span class="line">--name mysql：运行服务名字</span><br><span class="line">-v /zykjuse/mysql/conf:/etc/mysql/conf.d ：将主机/zykjuse/mysql目录下的conf/my.cnf 挂载到容器的 /etc/mysql/conf.d</span><br><span class="line">-v /zykjuse/mysql/logs:/logs：将主机/zykjuse/mysql目录下的 logs 目录挂载到容器的 /logs。</span><br><span class="line">-v /zykjuse/mysql/data:/var/lib/mysql ：将主机/zykjuse/mysql目录下的data目录挂载到容器的 /var/lib/mysql </span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456：初始化 root 用户的密码。</span><br><span class="line">-d mysql:5.7 : 后台程序运行mysql5.7</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it MySQL运行成功后的容器ID  /bin/bash</span><br></pre></td></tr></table></figure></li><li>外部Win10也来连接运行在docker上的mysql服务</li><li>数据备份小测试(可以不做)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec mysql服务容器ID sh -c &#x27; exec mysqldump --all-databases -uroot -p&quot;123456&quot; &#x27; &gt; /zykjuse/all-databases.sql</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h3><ol><li><p>从docker hub.上(阿里云加速器)拉取redis镜像到本地标签为3.2</p></li><li><p>使用redis3. 2镜像创建容器(也叫运行镜像)</p><ul><li><p>使用镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6379:6379 -v /zykjuse/myredis/data:/data -v /zykjuse/myredis/conf/redis.conf:/usr/local/etc/redis/redis.conf  -d redis:3.2 redis-server /usr/local/etc/redis/redis.conf --appendonly <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p>命令说明：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-p 6379:6379：将主机的6379端口映射到docker容器的3306端口。</span><br><span class="line">-v /zykjuse/myredis/data:/data：将主机/zykjuse/myredis目录下的 data 目录挂载到容器的 /data。</span><br><span class="line">-v /zykjuse/myredis/conf/redis.conf:/usr/local/etc/redis/redis.conf：将主机/zykjuse/myredis/conf/目录下的 redis.conf 目录 挂载到容器的 /usr/local/etc/redis/redis.conf</span><br><span class="line">-d redis:3.2 redis-server: 后台程序运行redis:3.2、redis-server</span><br><span class="line">--appendonly yes：开启AOF模式</span><br></pre></td></tr></table></figure></li><li><p>在主机 &#x2F;zykjuse&#x2F;myredis&#x2F;conf&#x2F;redis.conf 目录下新建redis.conf文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /zzyuse/myredis/conf/redis.conf/redis.conf</span><br></pre></td></tr></table></figure><p><code>redis.conf</code> 在这里可以复制 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/antirez/redis/blob/unstable/redis.conf">https://github.com/antirez/redis/blob/unstable/redis.conf</a></p></li><li><p>测试redis cli连接上来</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 运行着Rediis服务的容器ID redis-cli</span><br></pre></td></tr></table></figure></li><li><p>测试持久化文件生成</p></li></ul></li></ol><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="IDEA整合Docker部署java项目"><a href="#IDEA整合Docker部署java项目" class="headerlink" title="IDEA整合Docker部署java项目"></a>IDEA整合Docker部署java项目</h3><h4 id="配置Docker的远程访问"><a href="#配置Docker的远程访问" class="headerlink" title="配置Docker的远程访问"></a>配置Docker的远程访问</h4><ol><li><p>修改&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /lib/systemd/system/docker.service</span><br></pre></td></tr></table></figure></li><li><p>替换ExecStart</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">替换</span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line">为</span><br><span class="line">ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200403094734.png"></p></li><li><p>重启Docker服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></li><li><p>查看2375端口是否被监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nlpt</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200403095311.png"></p></li><li><p>服务器防火墙开启2375端口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 开放2375端口</span><br><span class="line">firewall-cmd --add-port=2375/tcp --permanent</span><br><span class="line"># 重启防火墙(修改配置后要重启防火墙)</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"># 查看开放的端口</span><br><span class="line">firewall-cmd --zone=public --list-ports</span><br><span class="line">  </span><br><span class="line"># 参数解释</span><br><span class="line">firwall-cmd：是Linux提供的操作firewall的一个工具；</span><br><span class="line">--permanent：表示设置为持久；</span><br><span class="line">--add-port：标识添加的端口； </span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200403103843.png"></p><p>如果是云服务器、那么还要添加安全组规则(这里以阿里云服务器为演示)<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200403103421.png"></p></li><li><p>验证是否成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">本地：</span><br><span class="line">   curl http://127.0.0.1:2375/version</span><br><span class="line">网页：</span><br><span class="line">   http://服务器IP:2375/version</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200403104848.png"><br>网页访问一样。</p></li></ol><h4 id="IDEA中配置Docker插件"><a href="#IDEA中配置Docker插件" class="headerlink" title="IDEA中配置Docker插件"></a>IDEA中配置Docker插件</h4><ul><li><p>确保IDEA安装Docker插件<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200404104926.png"></p></li><li><p>打开设置<code>Settings-&gt;Build,Execution,Deployment</code>、找到Docker添加</p></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200403170430.png"></p><p>配置好了会显示<code>Connection successful</code></p><p>接下来配置镜像加速</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200403171417.png"></p><p>点击OK之后，下方控制栏，出现Docker控制台</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200403173150.png"></p><h4 id="集成Maven插件"><a href="#集成Maven插件" class="headerlink" title="集成Maven插件"></a>集成Maven插件</h4><ul><li><p>在项目的pom.xml文件中添加以下内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--docker镜像的前缀--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">docker.image.prefix</span>&gt;</span>docker<span class="tag">&lt;/<span class="name">docker.image.prefix</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spotify<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docker-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--远程Docker的地址--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dockerHost</span>&gt;</span>http://localhost:2375<span class="tag">&lt;/<span class="name">dockerHost</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--镜像名称，前缀/项目名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">imageName</span>&gt;</span>$&#123;docker.image.prefix&#125;/$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">imageName</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定标签--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">imageTags</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">imageTag</span>&gt;</span>latest<span class="tag">&lt;/<span class="name">imageTag</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">imageTags</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- 指定 Dockerfile 路径 $&#123;project.basedir&#125;：项目根路径下--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dockerDirectory</span>&gt;</span>src/main/docker<span class="tag">&lt;/<span class="name">dockerDirectory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 这里是复制 jar 包到 docker 容器指定目录配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>/<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--jar 包所在的路径 此处配置的 即对应 target 目录--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 需要包含的 jar包 ，这里对应的是 Dockerfile中添加的文件名　--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>根据配置的 <code>&lt;dockerDirectory&gt;src/main/docker&lt;/dockerDirectory&gt;</code> 在<code>src</code>的<code>main</code>创建docker目录、编写Dockerfile</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> /tmp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> *.jar app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><ul><li>Maven生成jar包</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200404112738.png"></p><p>确保 <code>target</code> 目录下有生成的jar包</p><ul><li>Maven构建镜像</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200404113216.png"></p><ul><li>运行Docker镜像</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200404114110.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200404114347.png"></p><p>然而、这样就行了吗？</p><blockquote><p>当然不行的,前面提到的配置是允许所有人都可以访问的，因为docker默认是root权限的，你把2375端口暴露在外面，意味着别人随时都可以提取到你服务器的root权限，是很容易被黑客黑的</p></blockquote><p><strong>我们需要继续配置</strong></p><h4 id="Docker-CA认证"><a href="#Docker-CA认证" class="headerlink" title="Docker CA认证"></a>Docker CA认证</h4><ul><li><p>创建ca文件夹，用于存放CA私钥和公钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/ca</span><br><span class="line"><span class="built_in">cd</span> /usr/local/ca/</span><br></pre></td></tr></table></figure></li><li><p>创建密码(需要连续输入两次相同的密码)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -aes256 -out ca-key.pem 4096</span><br></pre></td></tr></table></figure></li><li><p>依次输入密码、国家、省、市、组织名称等(随便输入、影响不大)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -days 365 -key ca-key.pem -sha256 -out ca.pem</span><br></pre></td></tr></table></figure></li><li><p>生成 <code>server-key.pem</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out server-key.pem 4096</span><br></pre></td></tr></table></figure></li><li><p>把下面的 <code>$Host</code> 换成你自己服务器外网的IP或者域名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl req -subj <span class="string">&quot;/CN=<span class="variable">$HOST</span>&quot;</span> -sha256 -new -key server-key.pem -out server.csr</span><br><span class="line"></span><br><span class="line">例子：</span><br><span class="line">openssl req -subj <span class="string">&quot;/CN=192.168.1.106&quot;</span> -sha256 -new -key server-key.pem -out server.csr</span><br><span class="line">openssl req -subj <span class="string">&quot;/CN=www.baidu.com&quot;</span> -sha256 -new -key server-key.pem -out server.csr</span><br></pre></td></tr></table></figure></li><li><p>配置白名单</p><blockquote><p>配置要允许那些ip可以连接到服务器的docker，因为已经是ssl连接，所以我推荐配置0.0.0.0,也就是所有ip都可以连接(但只有拥有证书的才可以连接成功)，这样配置好之后公司其他人也可以使用。如果你不想这样，那你可以配置ip，用逗号分隔开。下面的<code>$Host</code>依旧是你服务器外网的IP或者域名，请自行替换。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">填写的是ip地址的话命令如下<span class="built_in">echo</span> subjectAltName = IP:<span class="variable">$HOST</span>,IP:0.0.0.0 &gt;&gt; extfile.cnf</span><br><span class="line"></span><br><span class="line">填写的是域名的话命令如下 <span class="built_in">echo</span> subjectAltName = DNS:<span class="variable">$HOST</span>,IP:0.0.0.0 &gt;&gt; extfile.cnf</span><br></pre></td></tr></table></figure></li><li><p>执行命令，将Docker守护程序密钥的扩展使用属性设置为仅用于服务器身份验证</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> extendedKeyUsage = serverAuth &gt;&gt; extfile.cnf</span><br></pre></td></tr></table></figure></li><li><p>执行命令，并输入之前设置的密码，生成签名证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 365 -sha256 -<span class="keyword">in</span> server.csr -CA ca.pem -CAkey ca-key.pem \-CAcreateserial -out server-cert.pem -extfile extfile.cnf</span><br></pre></td></tr></table></figure></li><li><p>生成客户端的key.pem，到时候把生成好的几个公钥私钥拷出去即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out key.pem 4096</span><br></pre></td></tr></table></figure></li><li><p>执行命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -subj <span class="string">&#x27;/CN=client&#x27;</span> -new -key key.pem -out client.csr</span><br></pre></td></tr></table></figure></li><li><p>执行命令，要使密钥适合客户端身份验证，请创建扩展配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> extendedKeyUsage = clientAuth &gt;&gt; extfile.cnf</span><br></pre></td></tr></table></figure></li><li><p>生成 <code>cert.pem</code> ,需要输入前面设置的密码，生成签名证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 365 -sha256 -<span class="keyword">in</span> client.csr -CA ca.pem -CAkey ca-key.pem \-CAcreateserial -out cert.pem -extfile extfile.cnf</span><br></pre></td></tr></table></figure></li><li><p>删除不需要的文件，两个证书签名请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -v client.csr server.csr</span><br></pre></td></tr></table></figure></li><li><p>修改权限，要保护您的密钥免受意外损坏，请删除其写入权限。要使它们只能被您读取，更改文件模式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> -v 0400 ca-key.pem key.pem server-key.pem</span><br></pre></td></tr></table></figure></li><li><p>证书可以是对外可读的，删除写入权限以防止意外损坏</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> -v 0444 ca.pem server-cert.pem cert.pem</span><br></pre></td></tr></table></figure></li><li><p>归集服务器证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> server-*.pem  /etc/docker/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> ca.pem /etc/docker/</span><br></pre></td></tr></table></figure></li><li><p>修改Docker配置，使Docker守护程序仅接受来自提供CA信任的证书的客户端的连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /lib/systemd/system/docker.service</span><br></pre></td></tr></table></figure></li><li><p>将 <code>ExecStart=/usr/bin/dockerd</code> 替换</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExecStart=/usr/bin/dockerd --tlsverify --tlscacert=/etc/docker/ca.pem --tlscert=/etc/docker/server-cert.pem --tlskey=/etc/docker/server-key.pem -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</span><br></pre></td></tr></table></figure></li><li><p>重新加载daemon并重启docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload </span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></li><li><p>重启docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure></li><li><p>复制这几个文件到本地</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200414195122.png"></p></li><li><p>回到IDEA</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/20200414195807.png"></p><ul><li>重新配置pom文件<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--CA存放路径--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dockerCertPath</span>&gt;</span>D:\ca<span class="tag">&lt;/<span class="name">dockerCertPath</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--docker镜像的前缀--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">docker.image.prefix</span>&gt;</span>docker<span class="tag">&lt;/<span class="name">docker.image.prefix</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spotify<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docker-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--远程Docker的地址--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dockerHost</span>&gt;</span>http://localhost:2375<span class="tag">&lt;/<span class="name">dockerHost</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--CA存放路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dockerCertPath</span>&gt;</span>D:\ca<span class="tag">&lt;/<span class="name">dockerCertPath</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--镜像名称，前缀/项目名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">imageName</span>&gt;</span>$&#123;docker.image.prefix&#125;/$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">imageName</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定标签--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">imageTags</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">imageTag</span>&gt;</span>latest<span class="tag">&lt;/<span class="name">imageTag</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">imageTags</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- 指定 Dockerfile 路径 $&#123;project.basedir&#125;：项目根路径下--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dockerDirectory</span>&gt;</span>src/main/docker<span class="tag">&lt;/<span class="name">dockerDirectory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 这里是复制 jar 包到 docker 容器指定目录配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>/<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--jar 包所在的路径 此处配置的 即对应 target 目录--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 需要包含的 jar包 ，这里对应的是 Dockerfile中添加的文件名　--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><p>最后重新生成jar包、重新构建docker镜像就可以了。</p><p>参考连接:</p><ul><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/lovexiaotaozi/article/details/82797236">【Docker】在IDEA中实现一键部署到服务器(附ssl连接加密)</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/engine/security/https/#create-a-ca-server-and-client-keys-with-openssl">Docker官方教程</a></li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://zykj.js.org">ZYKJ</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://zykj.js.org/posts/2c867817/">https://zykj.js.org/posts/2c867817/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zykj.js.org" target="_blank">ZYKJ's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><div class="post_share"><div class="social-share" data-image="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/dockerinstall-cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://gcore.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/alipay.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/alipay.png" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/wechat.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/wechat.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/6536dfdf/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/gituse-cover.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Git的安装与使用</div></div></a></div><div class="next-post pull-right"><a href="/posts/e55bad60/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tva3.sinaimg.cn/large/0072Vf1pgy1foxk6omvpzj31hc0u0nhh.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hexo博客搭建 与 美化教程</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjofficial.github.io@master/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">ZYKJ</div><div class="author-info__description">做一个普普通通的人.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://space.bilibili.com/241230332"><i class="fas fa-bold"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://space.bilibili.com/241230332" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="fas fa-bold"></i></a><a class="social-icon" href="https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/WeChat_Official_Account.jpg" rel="external nofollow noreferrer" target="_blank" title="微信公众号"><i class="fab fa-weixin"></i></a><a class="social-icon" href="https://github.com/zykjofficial/" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客！<br><div class="item-headline" style="margin:10px 0"><i class="fas fa-laptop card-announcement-animation"></i><span>关于本站</span></div><div class="github-badge"><a style="color:#fff" href="https://hexo.io/" rel="external nofollow noreferrer" target="_blank" title="由 Hexo 强力驱动"><span class="badge-subject">Powered</span><span class="badge-value bg-blue">Hexo 6.0.0</span></a><a style="color:#fff" href="https://vercel.com/" rel="external nofollow noreferrer" target="_blank" title="静态网页托管于 Vercel"><span class="badge-subject">Hosted</span><span class="badge-value bg-brightgreen">Vercel</span></a><a style="color:#fff" href="https://www.jsdelivr.com/" rel="external nofollow noreferrer" target="_blank" title="jsDelivr 提供 CDN 加速服务"><span class="badge-subject">CDN</span><span class="badge-value bg-orange">jsDelivr</span></a><a style="color:#fff" href="https://github.com/jerryc127/hexo-theme-butterfly" rel="external nofollow noreferrer" target="_blank" title="站点使用 Butterfly 4.5.0-b1版本 主题"><span class="badge-subject">Theme</span><span class="badge-value bg-blue">Butterfly 4.5.0-b1</span></a><a style="color:#fff" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank" title="本站点采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可"><span class="badge-subject"><i class="fa fa-copyright"></i></span><span class="badge-value bg-lightgrey">BY-NC-SA 4.0</span></a></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">Docker的安装与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E5%87%86%E5%A4%87"><span class="toc-number">1.1.</span> <span class="toc-text">需要准备</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">Docker概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Docker"><span class="toc-number">2.1.</span> <span class="toc-text">安装 Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">2.2.</span> <span class="toc-text">配置镜像加速</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">Docker常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.3.</span> <span class="toc-text">容器命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">3.4.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">4.</span> <span class="toc-text">Docker容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">4.1.</span> <span class="toc-text">数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%86%85%E6%B7%BB%E5%8A%A0"><span class="toc-number">4.1.1.</span> <span class="toc-text">容器内添加</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%91%BD%E4%BB%A4%E6%B7%BB%E5%8A%A0"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">直接命令添加</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Dockerfile%E6%B7%BB%E5%8A%A0"><span class="toc-number">4.1.1.2.</span> <span class="toc-text">Dockerfile添加</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">4.2.</span> <span class="toc-text">数据卷容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E9%97%B4%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB-volumes-from"><span class="toc-number">4.2.1.</span> <span class="toc-text">容器间数据共享 - -volumes-from</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile"><span class="toc-number">5.</span> <span class="toc-text">DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E4%B8%89%E4%B8%AA%E6%AD%A5%E9%AA%A4"><span class="toc-number">5.1.</span> <span class="toc-text">构建三个步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%E8%A7%A3%E6%9E%90"><span class="toc-number">5.2.</span> <span class="toc-text">Dockerfile构建过程解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E6%89%A7%E8%A1%8CDockerfile%E7%9A%84%E5%A4%A7%E8%87%B4%E6%B5%81%E7%A8%8B"><span class="toc-number">5.3.</span> <span class="toc-text">Docker执行Dockerfile的大致流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84-%E4%BF%9D%E7%95%99%E5%AD%97%E6%8C%87%E4%BB%A4"><span class="toc-number">5.4.</span> <span class="toc-text">Docker体系结构(保留字指令)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">5.5.</span> <span class="toc-text">案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Base%E9%95%9C%E5%83%8F-scratch"><span class="toc-number">5.5.1.</span> <span class="toc-text">Base镜像(scratch)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8Fmycentos"><span class="toc-number">5.5.2.</span> <span class="toc-text">自定义镜像mycentos</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CMD-ENTRYPOINT%E6%A1%88%E4%BE%8B"><span class="toc-number">5.5.3.</span> <span class="toc-text">CMD&#x2F;ENTRYPOINT案例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Tomcat9%E9%95%9C%E5%83%8F"><span class="toc-number">5.5.4.</span> <span class="toc-text">自定义Tomcat9镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93"><span class="toc-number">5.6.</span> <span class="toc-text">小总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">安装软件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Tomcat"><span class="toc-number">6.1.</span> <span class="toc-text">安装Tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85MySQL"><span class="toc-number">6.2.</span> <span class="toc-text">安装MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Redis"><span class="toc-number">6.3.</span> <span class="toc-text">安装Redis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">7.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IDEA%E6%95%B4%E5%90%88Docker%E9%83%A8%E7%BD%B2java%E9%A1%B9%E7%9B%AE"><span class="toc-number">7.1.</span> <span class="toc-text">IDEA整合Docker部署java项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEDocker%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE"><span class="toc-number">7.1.1.</span> <span class="toc-text">配置Docker的远程访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IDEA%E4%B8%AD%E9%85%8D%E7%BD%AEDocker%E6%8F%92%E4%BB%B6"><span class="toc-number">7.1.2.</span> <span class="toc-text">IDEA中配置Docker插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E6%88%90Maven%E6%8F%92%E4%BB%B6"><span class="toc-number">7.1.3.</span> <span class="toc-text">集成Maven插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-CA%E8%AE%A4%E8%AF%81"><span class="toc-number">7.1.4.</span> <span class="toc-text">Docker CA认证</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image:url(https://gcore.jsdelivr.net/gh/zykjofficial/zykjimg/img/dockerinstall-cover.png)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By ZYKJ</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">CDN BY <a target="_blank" href="https://www.jsdelivr.com/" rel="external nofollow noreferrer" data-pjax-state=""><b>jsDelivr</b></a> | HOST BY <a target="_blank" href="https://vercel.com/" rel="external nofollow noreferrer"><b>Vercel</b></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjofficial.github.io@master/js/utils.js"></script><script src="https://gcore.jsdelivr.net/gh/zykjofficial/zykjofficial.github.io@master/js/main.js"></script><script src="https://gcore.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://gcore.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://gcore.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://gcore.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://gcore.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){GLOBAL_CONFIG_SITE.isPost&&panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{const o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"twikoo-4g2ypman52a24a4b",region:"",onCommentLoaded:function(){btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&(()=>{const o=document.getElementById("twikoo-count");o&&twikoo.getCommentsCount({envId:"twikoo-4g2ypman52a24a4b",region:"",urls:[window.location.pathname],includeReply:!1}).then((function(t){o.innerText=t[0].count})).catch((function(o){console.error(o)}))})()},t=()=>{"object"!=typeof twikoo?getScript("https://gcore.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js").then(o):setTimeout(o,0)};btf.loadComment(document.getElementById("twikoo-wrap"),t)})()</script></div><script>window.addEventListener("load",()=>{const e=e=>{let t="";if(e.length)for(let n=0;n<e.length;n++)t+="<div class='aside-list-item'>",t+=`<div class='content'>\n        <a class='comment' href='${e[n].url}' title='${e[n].content}'>${e[n].content}</a>\n        <div class='name'><span>${e[n].nick} / </span><time datetime="${e[n].date}">${btf.diffDate(e[n].date,!0)}</time></div>\n        </div></div>`;else t+="没有评论";let n=document.querySelector("#card-newest-comments .aside-list");n.innerHTML=t,window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n)},t=()=>{if(document.querySelector("#card-newest-comments .aside-list")){const t=saveToLocal.get("twikoo-newest-comments");t?e(JSON.parse(t)):(()=>{const t=()=>{twikoo.getRecentComments({envId:"twikoo-4g2ypman52a24a4b",region:"",pageSize:3,includeReply:!0}).then((function(t){const n=t.map(e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()};var t});saveToLocal.set("twikoo-newest-comments",JSON.stringify(n),10/1440),e(n)})).catch((function(e){document.querySelector("#card-newest-comments .aside-list").innerHTML="无法获取评论，请确认相关配置是否正确"}))};"object"==typeof twikoo?t():getScript("https://gcore.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js").then(t)})()}};t(),document.addEventListener("pjax:complete",t)})</script><div class="app-refresh" id="app-refresh"><div class="app-refresh-wrap"><label>🚀 网站已更新最新版本 📑</label> <a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()">点我更新</a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"🚀 博客已更新最新版本 🌍",backgroundColor:t,duration:5e5,pos:e,actionText:"点我更新⚡",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script><script src="https://gcore.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors=["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/catchcat/"]):not([href="/shuoshuo/"]):not([href="/music/"]):not([href="/about/"]):not([href="/friendcircle/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.tocScrollFn&&window.removeEventListener("scroll",window.tocScrollFn),window.scrollCollect&&window.removeEventListener("scroll",scrollCollect),"object"==typeof preloader&&preloader.initLoading(),document.getElementById("rightside").style.cssText="opacity: ''; transform: ''",window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode"),"object"==typeof disqusjs&&disqusjs.destroy()})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script></div></body></html>